<!DOCTYPE html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Advanced JS class</title>
  
  <link rel="stylesheet" href="reveal/css/reveal.min.css">
  <link rel="stylesheet" href="reveal/lib/css/googlecode.css">

  <link rel="stylesheet" href="slides-theme/style.css">
  <link rel="stylesheet" href="slides-theme/talk-specific.css">

  <!-- demos -->

  <!-- for live coding -->
  <link rel="stylesheet" href="js/little-console.css" id="theme">

  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24335480-1']);
  _gaq.push(['_trackPageview']);

  var asyncScript = function(src) {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = src;
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  };

  asyncScript(('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js');
  </script>

  <script src="js/revealHooks.js"></script>

</head>

<body>

  <div class="reveal">
    <div class="slides">
<section data-state='notitle' class=" notitle"><h2 id="advanced-javascript">Advanced Javascript</h2>
<p><img src="media/title.png"></p>
</section>

<section  class=""><h2 id="today">Today</h2>
<blockquote>
<p>Giving you strong core JS skills, ready to tackle modern JS codebases!</p>
</blockquote>
</section>

<section data-state='notitle' class=" notitle"><h2 id="platforms">Platforms</h2>
<p><img src=media/platforms.png></p>
</section>

<section  class=""><h2 id="agenda">Agenda</h2>
<ol>
<li>Core language</li>
<li>Data-structures</li>
<li>Objects</li>
<li>Async</li>
<li>Tooling</li>
</ol>
</section>

<section  class=""><h2 id="method">Method</h2>
<ol>
<li>Demo</li>
<li>Exercise</li>
<li>Deepen</li>
</ol>
</section>

<section  class=""><h2 id="our-guide">Our guide</h2>
<pre><code class="lang-Javascript">console.log(anything)
</code></pre>
</section>

<section  class=""><h2 id="ages-of-js">Ages of JS</h2>
<ul>
<li><del>ES3</del> (obsolete)</li>
<li><del>ES5 sloppy</del> (avoid)</li>
<li>ES5 strict</li>
<li>ES.Next</li>
</ul>
</section>

<section data-state='notitle' class=" notitle"><h2 id="landscape-diagram">Landscape diagram</h2>
<p><img src="media/es landscape.png"></p>
</section>

<section  class=""><h2 id="strict">Strict</h2>
<pre><code class="lang-javascript">// &lt;- first non-comment line of file or function
&quot;use strict&quot;;
</code></pre>
</section>

<section  class=""><h2 id="tightens-up-language">Tightens up language</h2>
<ul>
<li>new to JS? Not missing anything!</li>
<li>removes <code>with</code></li>
<li>bans duplicate properties</li>
<li>implicit globals</li>
</ul>
</section>

<section  class=""><h2 id="today-es5-strict-es6">Today: ES5 strict, &amp; ES6</h2>
<p>All code will run in strict, with ES6.</p>
</section>

<section  class=""><h2 id="exercise-intro">Exercise intro</h2>
<pre><code class="lang-sh">./exercises/some-name
  exercise.js
</code></pre>
<pre><code class="lang-sh">cd ./exercises/some-name
node verify
</code></pre>
</section>

<section data-state='title' class=" title"><h2 id="core">Core</h2>
</section>

<section  class=""><h2 id="aim">Aim</h2>
<ul>
<li>Effective &quot;programming in the small&quot;</li>
<li>Writing JS like a native</li>
</ul>
</section>

<section data-state='title' class=" title"><h2 id="variables">Variables</h2>
</section>

<section  class=""><h2 id="two-ages">Two ages</h2>
<ul>
<li>Pre-ES.next: <code>var</code></li>
<li>Post: <code>let</code>, <code>const</code></li>
</ul>
</section>

<section  class=""><h2 id="-var-"><code>var</code></h2>
<pre><code class="lang-javascript">var someVariable;
var anotherVariable = &quot;hello&quot;;
</code></pre>
</section>

<section  class=""><h2 id="-undefined-vs-undeclared"><code>undefined</code> vs undeclared</h2>
<pre><code class="lang-javascript">var notDefined;

console.log(notDefined); // ?
</code></pre>
</section>

<section  class=""><h2 id="undeclared">Undeclared</h2>
<pre><code class="lang-javascript">var someVar;

console.log(smeVar); // typo, what happens??
</code></pre>
</section>

<section  class=""><h2 id="-const-"><code>const</code></h2>
<pre><code class="lang-javascript">const doesNotChange = &quot;hi&quot;;

// throws TypeError
doesNotChange = &quot;I&#39;ll try my luck&quot;;
</code></pre>
</section>

<section  class=""><h2 id="rule-use-const-if-possible">Rule: use <code>const</code> if possible</h2>
<ul>
<li>one less source of bugs</li>
<li>variables stand out</li>
</ul>
</section>

<section  class=""><h2 id="-let-"><code>let</code></h2>
<pre><code class="lang-javascript">let hiThere = &quot;hello&quot;;

if(true) {
  let hiThere = &quot;GOODBYE&quot;;
}

console.log(hiThere) // which?
</code></pre>
</section>

<section  class=""><h2 id="block-scope">Block scope</h2>
<pre><code class="lang-javascript">for(let i = 0; i++; i &lt; 10) {
  console.log(i);
}

// reference error
console.log(i);
</code></pre>
</section>

<section data-state='notitle' class=" notitle"><h2 id="diagram-of-block-scope">Diagram of block scope</h2>
<p><img src="media/block-scopes.png"></p>
</section>

<section  class=""><h2 id="rule-use-let-in-loops-etc">Rule: use <code>let</code> in loops etc</h2>
<ul>
<li>one less source of bugs</li>
<li>clearer where variables belong</li>
</ul>
</section>

<section  class=""><h2 id="what-about-var-">What about <code>var</code>?</h2>
</section>

<section  class=""><h2 id="-var-function-scoped"><code>var</code> = function scoped</h2>
</section>

<section  class=""><h2 id="function-scope">Function scope</h2>
</section>

<section data-state='notitle' class=" notitle"><h2 id="diagram-of-function-scope">Diagram of function scope</h2>
<p><img src="media/function-scopes.png"></p>
</section>

<section  class=""><h2 id="one-weird-quirk">One weird quirk</h2>
<pre><code class="lang-javascript">function main() {
  // what happens here?
  console.log(i);

  for(var i = 0; i&lt;10; i++) {
    console.log(i);
  }
}
</code></pre>
</section>

<section  class=""><h2 id="hoisting">Hoisting</h2>
<pre><code class="lang-javascript">function main() {
  ⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️
  # this is the &#39;hoisting zone&#39;, where 
  # all var statements are hoisted before invocation
  SCOPE := { i: undefined }

  # NOTE: JUST for intuition - lightning bolt sections
  # are to give intuition for interpreter actions
  ⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️

  console.log(i);

  for(var i = 0; i&lt;10; i++) {
    console.log(i);
  }
}
</code></pre>
</section>

<section  class=""><h2 id="global-scope">Global scope</h2>
<pre><code class="lang-javascript">// browser - sloppy mode
something = &quot;I am global&quot;;


// browser - strict mode
window.something = &quot;I am global&quot;;

// node
global.something = &quot;I am global&quot;;
</code></pre>
</section>

<section  class=""><h2 id="acessing-global-object">Acessing global object</h2>
<pre><code class="lang-javascript">this; // sloppy, outside functions

window; // browser
global; // node
</code></pre>
</section>

<section  class=""><h2 id="exercise-">Exercise!</h2>
<pre><code>exercises/variables
</code></pre></section>

<section data-state='title' class=" title"><h2 id="primitives">Primitives</h2>
</section>

<section  class=""><h2 id="string">String</h2>
<pre><code class="lang-javascript">var name = &#39;Tim&#39;;
var opinion = &quot;Double quotes: they&#39;re worth it&quot;;

var complete = `${name}: ${opinion}`;
</code></pre>
</section>

<section  class=""><h2 id="template-strings">Template strings</h2>
<pre><code class="lang-javascript">var complete = <code>${name}: ${opinion}</code>;

var es5Html = &quot;&lt;h1&gt;Ugh&lt;/h1&gt;&quot; +
  &quot;&lt;p&gt;This is horrid&lt;/p&gt;&quot;;

var html = `
  &lt;h1&gt;Writing HTML with ES.Next&lt;/h1&gt;
  &lt;p&gt;Much nicer&lt;/p&gt;
`;
</code></pre>
</section>

<section  class=""><h2 id="-number-"><code>Number</code></h2>
<pre><code class="lang-javascript">var floaty = 1;

var floatsAreApproximate = 0.1 + 0.2; // ?
</code></pre>
</section>

<section  class=""><h2 id="boolean">Boolean</h2>
<pre><code class="lang-javascript">var t = true;
</code></pre>
</section>

<section  class=""><h2 id="quiz-truthy-vs-falsy">Quiz: truthy vs falsy</h2>
<pre><code class="lang-javascript">var empty = Boolean(&quot;&quot;); // true

Boolean(&quot;hello&quot;); // ?

Boolean(0); // ?
Boolean(1); // ?
Boolean(7); // ?

Boolean(true); // ?
</code></pre>
</section>

<section  class=""><h2 id="quiz">Quiz</h2>
<pre><code class="lang-javascript">var booly = new Boolean(false);

Boolean(booly);
</code></pre>
</section>

<section  class=""><h2 id="rule-never-wrap-primitives">Rule: never wrap primitives</h2>
<pre><code class="lang-javascript">// ARRRRRGGGHHHH!!!!!
var x = new String(&quot;&quot;);
var 1 = new Number(&quot;&quot;);
</code></pre>
</section>

<section  class=""><h2 id="rule-use-boolean-">Rule: use <code>Boolean</code></h2>
<pre><code class="lang-javascript">var x = &quot;&quot;;
var coerced = Boolean(x);

// NOOOOOOOOOO - never wrap primitives
var evil = new Boolean(false);
</code></pre>
</section>

<section  class=""><h2 id="-undefined-and-null-"><code>undefined</code> and <code>null</code></h2>
<pre><code class="lang-javascript">var x; // ?

var y = null;
</code></pre>
</section>

<section  class=""><h2 id="-null-undefined-"><code>null</code> &amp; <code>undefined</code></h2>
<p>A nuisance since 1995.</p>
</section>

<section  class=""><h2 id="comparison">Comparison</h2>
</section>

<section  class=""><h2 id="yes-has-issues">Yes <code>==</code> has issues</h2>
</section>

<section  class=""><h2 id="rule-always-use-">Rule: always use <code>===</code></h2>
</section>

<section  class=""><h2 id="but-one-time-to-use-">But <em>ONE</em> time to use <code>==</code></h2>
</section>

<section  class=""><h2 id="detecting-null-or-undefined-">Detecting <code>null</code> or <code>undefined</code></h2>
<pre><code>var undefinedNotEqeqeqNull = undefined === null; // false

// what a chore!
if(x === null || x === undefined) {
}

var nullish = x == null;
</code></pre></section>

<section  class=""><h2 id="rule-use-null-">Rule: use <code>== null</code></h2>
<pre><code class="lang-javascript">var nullish = x == null;
</code></pre>
</section>

<section  class=""><h2 id="-"><code>===</code></h2>
<ol>
<li>Same type?</li>
<li><p>Same value?</p>
</li>
<li><p>Special cases: <code>NaN !== NaN</code></p>
</li>
<li>Objects (non primitives): compares by identity, not value</li>
</ol>
</section>

<section data-state='title' class=" title"><h2 id="functions">Functions</h2>
<p><img src="slides-theme/img/eval-apply.jpg" style='width:476px; display:block; margin: 0 auto'></p>
</section>

<section  class=""><h2 id="three-ways-to-define">Three ways to define</h2>
</section>

<section  class=""><h2 id="declare">Declare</h2>
<pre><code class="lang-javascript">function add(a,b) {
  return a + b;
}
</code></pre>
</section>

<section  class=""><h2 id="expression">Expression</h2>
<pre><code class="lang-javascript">var add = function(a, b) {
  return a + b;
}
</code></pre>
</section>

<section  class=""><h2 id="fat-arrow">Fat-arrow</h2>
<pre><code class="lang-javascript">// note: lack of `return`
var add = (a, b) =&gt; a + b;

// note: multiple expressions requires {} and `return`
var twoStep = (a, b) =&gt; { console.log(a); return b }
</code></pre>
</section>

<section  class=""><h2 id="evaluating-functions">Evaluating functions</h2>
<pre><code class="lang-javascript">var result = add(add(10, 5), add(5, add(-5, 5)));

// steps for JS to evaluate right-hand-side
add(add(10, 5), add(5, add(-5, 5)));
add(15 ,        add(5, add(-5, 5)));
add(15 ,        add(5, 0         ));
add(15 ,        5                 );
20
</code></pre>
</section>

<section  class=""><h2 id="why-are-functions-important-">Why are functions important?</h2>
</section>

<section  class=""><h2 id="-"> </h2>
<blockquote>
<p>Establishing languages is a powerful way to control complexity</p>
</blockquote>
</section>

<section  class=""><h2 id="languages-">Languages?</h2>
</section>

<section  class=""><h2 id="imagine-if-js-had-only-one-more-feature-">Imagine if JS had only one more feature...</h2>
</section>

<section  class=""><h2 id="-if-"><code>if</code></h2>
<pre><code class="lang-javascript">if(testedForTruthy) {
  console.log(&quot;was truthy&quot;);
} else {
  console.log(&quot;was falsy&quot;);
}
</code></pre>
</section>

<section  class=""><h2 id="would-we-have-enough-to-write-programs-">Would we have enough to write programs?</h2>
</section>

<section  class=""><h2 id="yes-">Yes!</h2>
</section>

<section  class=""><h2 id="wouldn-t-we-be-missing-">Wouldn&#39;t we be missing?</h2>
<pre><code class="lang-javascript">while / do / for / try
</code></pre>
</section>

<section  class=""><h2 id="sure-but-">Sure, but...</h2>
</section>

<section  class=""><h2 id="-we-can-make-them">...we can make them</h2>
<pre><code class="lang-javascript">function while_(test, block) {
  if(test()) {
    block();
    return while_(test, block); 
  }
}

var x = 10;
while_(() =&gt; { x = x - 1 }, 
  () =&gt; {
    console.log(&quot;X: &quot; + x);
  })
</code></pre>
</section>

<section  class=""><h2 id="functions-the-core">Functions = the core</h2>
<video width="475" height="352" controls>
  <source src="slides-theme/movies/spirit-of-the-computer.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
</video>

</section>

<section  class=""><h2 id="a-language-to-describe-problems">A language to describe problems</h2>
<blockquote>
<p>Establishing languages controls complexity</p>
</blockquote>
<p>SICP</p>
</section>

<section  class=""><h2 id="parameters">Parameters</h2>
<pre><code class="lang-javascript">// variable length functions
function sprintf(format, ...args) {
  console.log(format, ...args);
}

const pair = [1,2];

// can use ... in calls too!
sprint(&quot;%s %s&quot;, ...pair);

// default parameters
function log(n, base = 10) {
  // ...
}
</code></pre>
</section>

<section  class=""><h2 id="-arguments-"><code>arguments</code></h2>
<pre><code class="lang-javascript">// in ES5, useful where we use ...rest params in ES6
function callMe() {
  // who needs parameters?
  console.log(&quot;Hello &quot; + arguments[0]);
}

callMe(&quot;a&quot;);
</code></pre>
</section>

<section data-state='title' class=" title"><h2 id="exercise-">Exercise!</h2>
<pre><code>exercises/functions-core
</code></pre></section>

<section data-state='title' class=" title"><h2 id="functions-continued">Functions, continued</h2>
</section>

<section  class=""><h2 id="closures">Closures</h2>
<ul>
<li>functions see var/let/const in surrounding function</li>
<li>this link remains long after surrounding fn clears</li>
</ul>
</section>

<section  class=""><h2 id="-"> </h2>
<p><img src="media/closures annotated.png"></p>
</section>

<section data-state='notitle' class=" notitle"><h2 id="context">Context</h2>
<p>We can see variables in functions that wrap us (red)</p>
<p><img src="media/closures annotated.png"></p>
</section>

<section data-state='notitle' class=" notitle"><h2 id="privacy">Privacy</h2>
<p>We can&#39;t see variables from inner functions (blue)</p>
<p><img src="media/closures annotated.png"></p>
</section>

<section  class=""><h2 id="coding-interview-spoiler">Coding interview spoiler</h2>
<pre><code class="lang-javascript">var elements = document.querySelectorAll(&quot;button&quot;);

// What is wrong here? How can we solve?
for(var i = 0; i &lt; elements.length; i++) {
  var element = elements[i];
  element.addEventListener(&quot;click&quot;, function() {
    console.log(element.innerHTML);
  });
}
</code></pre>
</section>

<section  class=""><h2 id="exercise">Exercise</h2>
<pre><code>exercise/closures
</code></pre></section>

<section data-state='title' class=" title"><h2 id="ordered-data-structures">Ordered data-structures</h2>
</section>

<section  class=""><h2 id="-array-"><code>Array</code></h2>
</section>

<section  class=""><h2 id="for-ordered-data">For ordered data</h2>
</section>

<section  class=""><h2 id="ordered">Ordered</h2>
<pre><code class="lang-script">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

primeMinisters[0] // Cameron;
primeMinisters[primeMinisters.length - 1] // Major - no negative indexes :(

console.log(primeMinisters.length) // 4
</code></pre>
</section>

<section  class=""><h2 id="extension">Extension</h2>
<pre><code class="lang-script">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

primeMinisters.unshift(&quot;Fry&quot;); // at start
primeMinisters.push(&quot;Thatcher&quot;); // at end


// what did we learn about const?
console.log(primeMinisters.length) // 6

primeMinisters.pop(); // drops end
primeMinisters.shift(); // drops start

console.log(primeMinisters.length) // 4
</code></pre>
</section>

<section  class=""><h2 id="subsets">Subsets</h2>
<pre><code class="lang-script">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

const lastLabourGovernment = primeMinisters.slice(1, 3);
lastLabourGovernment.reverse().join(&quot; then &quot;) // Blair then Brown


primeMinisters.sort();

// what can we tell about .sort() and mutation?
console.log(primeMinisters) // [ &#39;Blair&#39;, &#39;Brown&#39;, &#39;Cameron&#39;, &#39;Major&#39; ]

// and sort order?
primeMinisters.sort((a,b) =&gt; a.length - b.length)
console.log(primeMinisters) // [ &#39;Blair&#39;, &#39;Brown&#39;, &#39;Major&#39;, &#39;Cameron&#39; ]
</code></pre>
</section>

<section  class=""><h2 id="-for-"><code>for</code></h2>
<pre><code class="lang-javascript">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

const initials = [];
for(let i = 0, l = primeMinisters.length; i &lt; l; i++) {
  initials[i] = primeMinisters[i][0];
}
</code></pre>
</section>

<section  class=""><h2 id="-array-likes"><code>Array</code>-likes</h2>
<ul>
<li>In JS, <code>arguments</code> object</li>
<li>In DOM, <code>NodeList</code></li>
</ul>
</section>

<section  class=""><h2 id="-for-in-"><code>for ... in</code></h2>
<pre><code class="lang-javascript">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

// what... is this allowed?
primeMinisters.metaData = &quot;hi&quot;;

// for ... in will go over all properties of arrays
const initials = [];
for(let i in primeMinisters) {
  initials[i] = primeMinisters[i][0];
}
</code></pre>
</section>

<section  class=""><h2 id="-for-of-"><code>for .. of</code></h2>
<pre><code class="lang-javascript">const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];
primeMinisters.metaData = &quot;hi&quot;;

// ES6 <code>for ... of</code> goes over VALUES of iterables
const initials = [];
for(let pm of primeMinisters) {
  initials.push(pm[0]);
}
</code></pre>
</section>

<section  class=""><h2 id="rule-avoid-for-in-of-on-arrays">Rule: avoid <code>for ... in/of</code> on arrays</h2>
</section>

<section  class=""><h2 id="functional-iteration">Functional iteration</h2>
<pre><code class="lang-javascript">// ES5 &#39;array additions&#39;
const primeMinisters = [&quot;Cameron&quot;, &quot;Brown&quot;, &quot;Blair&quot;, &quot;Major&quot;];

primeMinisters.filter((p) =&gt; p[0] === &quot;B&quot;) // [&quot;Brown&quot;,&quot;Blair&quot;];

primeMinisters.map((p) =&gt; p[0]) // [ &#39;B&#39;, &#39;B&#39;, &#39;M&#39;, &#39;C&#39; ]

primeMinisters.reduce((s, e) =&gt; s + &quot;:&quot; + e) // &#39;Blair:Brown:Major:Cameron&#39;
</code></pre>
</section>

<section  class=""><h2 id="rule-prefer-functional-iterators">Rule: prefer functional iterators</h2>
<ul>
<li>intention revealing</li>
<li>shorter, less error-prone</li>
</ul>
</section>

<section  class=""><h2 id="remember-compares-by-identity">Remember: compares by identity</h2>
<pre><code class="lang-javascript">const byValue = [1,2] === [1,2]; // false

const couldStringify = JSON.stringify([1,2]) 
  === JSON.stringify([1,2]); // true
</code></pre>
</section>

<section  class=""><h2 id="exercise">Exercise</h2>
<pre><code>exercises/arrays
</code></pre></section>

<section data-state='title' class=" title"><h2 id="key-value-data-structures">Key-value data-structures</h2>
</section>

<section  class=""><h2 id="objects-used-as-dictionaries">Objects, used as dictionaries</h2>
<pre><code class="lang-javascript">const enToFr = {};

enToFr.hello = &quot;bonjour&quot;;
enToFr.cheese = &quot;fromage&quot;;

// equivalent
console.log(enToFr.hello);
console.log(enToFr[&quot;hello&quot;]);
</code></pre>
</section>

<section  class=""><h2 id="keys-are-strings-values-any">Keys are strings, values = any</h2>
<pre><code class="lang-javascript">const dict = {};

dict[10] = &quot;ten&quot;;

dict[&quot;10&quot;] // &quot;ten&quot;

// general rule: calls toString on non-strings
const convertsToTen = {
  toString: () =&gt; &quot;10&quot;
};

dict[convertsToTen] // &quot;ten&quot;
</code></pre>
</section>

<section  class=""><h2 id="es6-dynamic-keys">ES6 - dynamic keys</h2>
<pre><code class="lang-javascript">// ES6
function create(property, value) {
  return {[&quot;id:&quot; + property]: value}
}

// ES5
function create(property, value) {
  var o = {};
  o[&quot;id:&quot; + property] = value;
  return o;
}
</code></pre>
</section>

<section  class=""><h2 id="missing-features">Missing features</h2>
<pre><code class="lang-javascript">const dict = {};

dict[1] = &quot;hello&quot;;

// how to count?
dict.length // undefined

Object.keys(dict).length // costs O(N)
</code></pre>
</section>

<section  class=""><h2 id="-map-es6-to-rescue"><code>Map</code>: ES6 to rescue</h2>
<pre><code class="lang-javascript">
const m = new Map;
const o = {};

m.size // 0

const a = [1,2];
const b = [1,2];

o = {[a]: &quot;A&quot;, [b]: &quot;B&quot;}

Object.keys(o).length // 1

m.set(a, &quot;A&quot;);
m.set(b, &quot;B&quot;);

m.size // 2

// can you see why this is happening?
m.get(a) // A
o[a] // B
</code></pre>
</section>

<section  class=""><h2 id="maps-for-of-">Maps: <code>for .. of</code></h2>
<pre><code class="lang-javascript">const m = new Map;
m.set(&quot;A&quot;, 1);
m.set(&quot;B&quot;, 2);

for(let i in m) {
  console.log(i) // not called! why?
}

for(let i of m) {
  console.log(i) // [&quot;A&quot;, 1], ...
}

for(let i of m.keys()) {
  console.log(i) // &quot;A&quot;, &quot;B&quot;
}

for(let i of m.values()) {
  console.log(i) // 1, 2
}

m.forEach((v, k) =&gt; console.log(v, k))
</code></pre>
</section>

<section  class=""><h2 id="-set-"><code>Set</code></h2>
<pre><code class="lang-javascript">// ES6 only

const s = new Set;
s.add([1,2]);
s.has([1,2]) // false


s.add(1);
s.has(1); // true

s.size // 2
s.add(1);
s.add(1);
s.size // 2
</code></pre>
</section>

<section  class=""><h2 id="exercise">Exercise</h2>
<pre><code>exercises/maps-objects-sets
</code></pre></section>

<section data-state='title' class=" title"><h2 id="objects">Objects</h2>
</section>

<section  class=""><h2 id="everythingisanobject-">EverythingIsAnObject... ?</h2>
<pre><code class="lang-javascript">var iAmAnObject = {};

var soAmI = 5;
soAmI.toFixed(2);

var meToo = &quot;goo&quot;;
meToo.join(&quot;since I have methods&quot;);

var imAnObject = [];
</code></pre>
</section>

<section  class=""><h2 id="-object-is-overloaded">&#39;Object&#39; is overloaded</h2>
</section>

<section  class=""><h2 id="definitions-in-js">Definitions in JS</h2>
<ul>
<li>everything that isn&#39;t <code>null</code>/<code>undefined</code></li>
<li>empty objects used as key-value stores</li>
<li>things that have functions in them that reference &#39;this&#39;</li>
</ul>
</section>

<section  class=""><h2 id="so-which-is-it-">So which is it?</h2>
</section>

<section data-state='bad' class=" bad"><h2 id="none-of-the-above">None of the above</h2>
</section>

<section  class=""><h2 id="let-s-ask-alan-kay">Let&#39;s ask Alan Kay</h2>
<blockquote>
<p>OOP to me means only messaging, local retention and hiding of state, and extreme late-binding of all things.</p>
</blockquote>
<p>Alan Kay</p>
</section>

<section  class=""><h2 id="so-what-do-alan-kay-s-objects-look-like-">So what do Alan Kay&#39;s objects look like?</h2>
</section>

<section data-state='notitle' class=" notitle"><h2 id="-"> </h2>
<p><img src="media/objects.png" alt="technical diagram of OOP"></p>
</section>

<section  class=""><h2 id="messaging-late-binding">Messaging &amp; late-binding</h2>
<ul>
<li>component sends a message</li>
<li>another components receives and does... whatever it likes</li>
</ul>
</section>

<section  class=""><h2 id="results-of-messaging">Results of messaging</h2>
<ul>
<li>decouples intent from implementation (polymorphism)</li>
<li>can&#39;t see/modify state of receiver</li>
</ul>
</section>

<section  class=""><h2 id="what-the-hell-are-objects-">What the hell are objects?</h2>
</section>

<section  class=""><h2 id="-objects-are-a-pattern">&#39;Objects&#39; are a pattern</h2>
<ul>
<li>not the specific implementation</li>
</ul>
</section>

<section  class=""><h2 id="alan-kay-s-objects-are">Alan Kay&#39;s objects are</h2>
<ul>
<li>entities that accept messages</li>
<li>that access hidden state</li>
<li>and do something in response to the message</li>
</ul>
</section>

<section data-state='title' class=" title"><h2 id="implementations">Implementations</h2>
</section>

<section  class=""><h2 id="what-do-we-need-">What do we need?</h2>
<ul>
<li>identity</li>
<li>state</li>
<li>messages</li>
</ul>
</section>

<section  class=""><h2 id="without-additional-syntax">Without additional syntax</h2>
</section>

<section data-state='notitle' class=" notitle"><h2 id="objects-via-closures">Objects via closures</h2>
<pre><code class="lang-javascript">// what technique is being used?

function Counter() {
  var count = 0;

  return {
    increment: () =&gt; {
      count += 1;
    },
    count: () =&gt; count,
  };
}


const c1 = counter();
const c2 = counter();

c1.increment();
c1.count(); // 1
c2.count(); // 0
</code></pre>
</section>

<section  class=""><h2 id="issue">Issue</h2>
<pre><code class="lang-javascript">var n = 1e6;
const counters = [];

// lots of copies of `increment` and `count`!
while(n--) {
  counters.push(Counter());
}
</code></pre>
</section>

<section  class=""><h2 id="examples-where-this-matters">Examples where this matters</h2>
<ul>
<li>Arrays</li>
<li>Element - DOM</li>
<li>Promise</li>
<li>Function</li>
<li>all will have 1,000s of instances</li>
</ul>
</section>

<section  class=""><h2 id="how-do-we-share-implementations-">How do we share implementations?</h2>
</section>

<section data-state='bad' class=" bad"><h2 id="closures-not-enough">Closures not enough</h2>
</section>

<section  class=""><h2 id="language-level-help-">Language level help!</h2>
<pre><code class="lang-javascript">this
</code></pre>
</section>

<section  class=""><h2 id="-this-on-invocation"><code>this</code> on invocation</h2>
<pre><code class="lang-javascript">function couter() {
  return {
    // same fn for all instances!
    increment: counterIncrement,
    count: 0, 
  };
}

var c1 = counter();
var c2 = counter();

c1.increment();
c2.count; // 0

function counterIncrement() {
  this.count += 1;
}
</code></pre>
</section>

<section  class=""><h2 id="magic-argument-this-">Magic argument <code>this</code></h2>
<pre><code class="lang-javascript">// this = someObject
someObject.someProperty();

const someProperty = this.someObject;

// this = enclosing this, likely global
someProperty();
</code></pre>
</section>

<section  class=""><h2 id="classic-bug">Classic bug</h2>
<pre><code class="lang-javascript">var someObject = {
  name: &quot;lil&#39; listeny&quot;,
  listen: function(el) {
    el.addEventListener(&quot;click&quot;, this.handle)
  },
  handle: function() {
    console.log(this.name);
  },
};

// what do we see console.log&#39;d?
someObject.listen(button);
button.click();
</code></pre>
</section>

<section  class=""><h2 id="how-can-we-fix-">How can we fix?</h2>
</section>

<section  class=""><h2 id="-"><code>=&gt;</code></h2>
<pre><code class="lang-javascript">var someObject = {
  // ...
  listen: function(el) {
    // fat arrow has lexical this! i.e this of current scope
    el.addEventListener(&quot;click&quot;, (e) =&gt; this.handle(e))
  },
  // ...
};
</code></pre>
</section>

<section  class=""><h2 id="-fn-bind-thisvalue-"><code>fn.bind(thisValue)</code></h2>
<pre><code class="lang-javascript">var someObject = {
  // ...
  listen: function(el) {
    // .bind returns a new fn, as if bound to this via closure
    el.addEventListener(&quot;click&quot;, this.handle.bind(this))
  },
  // ...
};
</code></pre>
</section>

<section  class=""><h2 id="writing-bind-">Writing <code>bind</code></h2>
<pre><code class="lang-javascript">function bind(fn, thisValue) {
  return function() {
    return fn.apply(thisValue, arguments);
  }
}
</code></pre>
</section>

<section  class=""><h2 id="enough-">Enough?</h2>
</section>

<section data-state='bad' class=" bad"><h2 id="nope">Nope</h2>
</section>

<section  class=""><h2 id="e-g">e.g</h2>
<pre><code class="lang-javascript">const el = document.querySelector(&quot;<em>&quot;);

console.log(_.keys(el).length) // 72!

document.querySelectorAll(&quot;</em>&quot;) // 1,002 for bbc.co.uk

// need to track per object
el.myCustomMethod = () =&gt; 1
</code></pre>
</section>

<section  class=""><h2 id="costly-to-assume-all-objects-different">Costly to assume all objects different</h2>
</section>

<section  class=""><h2 id="want-flexibility-and-efficency">Want: flexibility and efficency</h2>
</section>

<section  class=""><h2 id="solution-prototypes-">Solution: prototypes!</h2>
</section>

<section data-state='notitle' class=" notitle"><h2 id="-"> </h2>
<p><img src="media/prototypes.png"></p>
</section>

<section  class=""><h2 id="additional-benefit">Additional benefit</h2>
<ul>
<li>some things modelled in chain</li>
<li>e.g store common tools at <code>Object</code></li>
</ul>
</section>

<section  class=""><h2 id="chain">Chain</h2>
<p><img src="media/prototype-chain.png"></p>
</section>

<section  class=""><h2 id="lookup-algorithm">Lookup algorithm</h2>
<pre><code class="lang-javascript">// always at run-time
function getProperty(object, prop) {
  if(object.hasOwnProperty(prop)) {
    return object[prop];
  } else {
    if(object.__proto__) {
      getProperty(object.__proto__, prop);
    } else {
      return undefined;
    }
  }
}
</code></pre>
</section>

<section data-state='notitle' class=" notitle"><h2 id="creating-object-with-prototype">Creating object with prototype</h2>
<pre><code class="lang-javascript">function Structure(width, height) {
  const self = Object.create(structurePt)
  self.width = width;
  self.height = height;
  return self;
} 

const structurePt = {
  squareArea: function() {
    return this.width * this.height;
  },
};

function House(w, h, bedrooms) {
  const self = Object.create(housePt)
  Structure.call(self, w, h);
  self.bedrooms = bedrooms;
  return self;
} 

const housePt = Object.create(Structure());
housePt.sleeps = function() {
  return this.bedrooms.reduce((s,b) =&gt; s + b.sleeps, 0)
};
</code></pre>
</section>

<section  class=""><h2 id="enough-">Enough?</h2>
</section>

<section data-state='bad' class=" bad"><h2 id="boilerplate">Boilerplate</h2>
</section>

<section  class=""><h2 id="-new-to-rescue-"><code>new</code> to rescue!</h2>
<pre><code class="lang-javascript">function Structure(width, height) {
  this.width = width;
  this.height = height;
} 

Structure.prototype = {
  squareArea: function() {
    return this.width * this.height;
  },
};

function House(w, h, bedrooms) {
  Structure.call(this, w, h);
  this.bedrooms = bedrooms;
} 

House.prototype = new Structure;
House.prototype.sleeps = function() {
  return this.bedrooms.reduce((s,b) =&gt; s + b.sleeps, 0)
};
</code></pre>
</section>

<section  class=""><h2 id="using-new-">Using <code>new</code></h2>
<pre><code class="lang-javascript">const house = new House(10, 20, []);
house.sleeps() // 0
</code></pre>
</section>

<section  class=""><h2 id="-new-in-depth"><code>new</code> in depth</h2>
<pre><code class="lang-javascript">function newOperator(constructor, ...args) {
  var instance = Object.create(constructor.prototype);
  var returnVal = constructor.apply(instance, args);
  return typeof returnVal == &quot;object&quot; ? returnVal : instance;
}
</code></pre>
</section>

<section  class=""><h2 id="enough-">Enough?</h2>
</section>

<section  class=""><h2 id="yes-probably">Yes, probably</h2>
</section>

<section data-state='bad' class=" bad"><h2 id="but">BUT</h2>
</section>

<section  class=""><h2 id="moar-">Moar!</h2>
<pre><code class="lang-javascript">class Structure{
  constructor(width, height) {
    this.width = width;
    this.height = height;
  }

  squareArea() {
    return this.width * this.height;
  }
} 


class House extends Structure {
  constructor(w, h, bedrooms) {
    super(w,h)
    this.bedrooms = bedrooms;
  }

  sleeps() {
    return this.bedrooms.reduce((s,b) =&gt; s + b.sleeps, 0)
  }
}
</code></pre>
</section>

<section  class=""><h2 id="using">Using</h2>
<p><img src=media/instance.png></p>
</section>

<section data-state='title' class=" title"><h2 id="async">Async</h2>
</section>

<section  class=""><h2 id="async-io">Async IO</h2>
<ul>
<li>ubiquitious in JS</li>
<li>the ecosystem default</li>
<li>vs subset of libraries in Ruby EM, Python Twisted</li>
</ul>
</section>

<section  class=""><h2 id="let-s-compare">Let&#39;s compare</h2>
</section>

<section  class=""><h2 id="synchronous-io">Synchronous IO</h2>
<ul>
<li>AKA &#39;blocking IO&#39;</li>
</ul>
<pre><code class="lang-javascript">1 // we&#39;ll not continue to the next line until the OS
2 // has read the file and provided it back to our process
3 var contents = fs.readFileSync(&quot;/tmp/hello&quot;, &quot;utf8&quot;);
4 
5 console.log(&quot;End of source file&quot;);
</code></pre>
</section>

<section  class=""><h2 id="asynchronous-io">Asynchronous IO</h2>
<ul>
<li>AKA &#39;non-blocking IO&#39;</li>
</ul>
<pre><code class="lang-javascript">1 fs.readFile(&quot;/tmp/hello&quot;, { encoding: &quot;utf8&quot; },
2  function(err, content) {
3    // (2/2) ...we get here
4    console.log(&quot;Read the file&quot;);
5  });
6
7 // (1/2) we&#39;ll get here waaaaaaaaaaaay before...
8 console.log(&quot;End of source file&quot;);
</code></pre>
</section>

<section  class=""><h2 id="clearing-the-stack">Clearing the stack</h2>
<ul>
<li>no code ever runs simultaneously</li>
<li>while code is running, no callbacks fire</li>
</ul>
</section>

<section data-state='notitle' class=" notitle"><h2 id="diagram-loop">Diagram loop</h2>
<p><img src="media/event-loop-schematic.png"></p>
</section>

<section  class=""><h2 id="rule-don-t-block-the-loop">Rule: don&#39;t block the loop</h2>
<ul>
<li>avoid long running, synchronous code</li>
<li>chunk</li>
<li>or delegate to other processes/WebWorkers</li>
</ul>
</section>

<section data-state='notitle' class=" notitle"><h2 id="diagram-starving-the-lop">Diagram: starving the lop</h2>
<p><img src="media/event-loop.png"></p>
</section>

<section  class=""><h2 id="sources-of-async">Sources of async</h2>
<ul>
<li><code>setTimeout</code></li>
<li>AJAX</li>
<li>IndexedDB, WebWorkers</li>
<li>most Node APIs (<code>fs</code>, <code>child_process</code>)</li>
</ul>
</section>

<section  class=""><h2 id="stacks">Stacks</h2>
<ul>
<li>languages with functions need a stack</li>
<li>keeps point to return to</li>
<li>stack &#39;unravels&#39; with errors</li>
</ul>
</section>

<section data-state='notitle' class=" notitle"><h2 id="stack-diagram">Stack diagram</h2>
<p><img src="media/stack-clear-errors.png"></p>
</section>

<section data-state='notitle' class=" notitle"><h2 id="with-async-no-one-can-hear-you-throw">With async, no one can hear you throw</h2>
<p><img src="media/stack-clear.png"></p>
</section>

<section  class=""><h2 id="e-g">e.g</h2>
<pre><code class="lang-javascript">// this stack is long gone...
try {

  create({}, function() {
    // ...
  })

} catch(e) {
  // never going to catch!
}
// waaaaay before...(1)

function create(data, cb) {
  $post(&quot;/api/create&quot;, data, function(err, ok) {
    if(err) {
      // (1)...we get here
      throw err;
    }
  })
}
</code></pre>
</section>

<section  class=""><h2 id="rule-don-t-throw-in-async">Rule: don&#39;t throw in async</h2>
</section>

<section data-state='title' class=" title"><h2 id="promises">Promises</h2>
</section>

<section  class=""><h2 id="an-iou">An IOU</h2>
<ul>
<li>A value, returned immediately</li>
<li>Fulfilled or rejected - once</li>
<li>Use before or after resolved</li>
<li>Chain together</li>
<li>Flow control for async</li>
</ul>
</section>

<section  class=""><h2 id="intuition">Intuition</h2>
<p><img src="media/promises.png" alt="Promise chain"></p>
</section>

<section  class=""><h2 id="promises-in-practice">Promises in practice</h2>
</section>

<section  class=""><h2 id="steps-in-process">Steps in process</h2>
<ul>
<li><code>.then(transformResolve, transformReject)</code></li>
</ul>
<pre><code class="lang-javascript">const user = getUser(params[&quot;id&quot;]);
const profile = user.then(getProfile);
const accountPage = Promise.all([user,profile])
  .then(accountPageTemplate);
</code></pre>
</section>

<section  class=""><h2 id="present-use-value">Present/use value</h2>
<ul>
<li>finally used more like callback</li>
</ul>
<pre><code class="lang-javascript">accountPage.then(
  renderHtml,
  renderErrorMessage
);
</code></pre>
</section>

<section  class=""><h2 id="-then-is"><code>then</code> is</h2>
<ul>
<li>Mostly: recipe for new values</li>
<li>Sometimes: actions when resolved</li>
</ul>
</section>

<section  class=""><h2 id="where-">Where?</h2>
<ul>
<li>ES5: libraries</li>
<li>ES6: built-in</li>
<li>Libraries actually better</li>
</ul>
</section>

<section  class=""><h2 id="promise-tools">Promise tools</h2>
<pre><code class="lang-javascript"> // returns a promise, if x is:
 // - a non-promise, a fulfilled promise for &#39;x&#39;
 // - a promise, that promise
Promise.resolve(x)

// a promise rejected with &#39;x&#39;
Promise.reject(x)

// a promise for an array/object with all resolved
// promises values - works with all iterables
Promise.all([promise, value, promiseB, valueB])

// a promise for first resolved
Promise.race([promise, value, promiseB, valueB])
</code></pre>
</section>

<section  class=""><h2 id="flow-control">Flow control</h2>
<pre><code class="lang-javascript">SomeQuery
  .then(transform)
  .then(function(value) {
    if(!isOk(value)) {
      return Promise.reject(Error(&quot;Not ok!&quot;))
    }

    return someTest(value)) ?
      QueryA(value) : QueryB(value);
  })
  .catch((err) =&gt; Promise.reject(Error(&quot;Query failed: &quot; + err)))
  .finally(function() {
    // anything that happens if resolved/rejected
  });
</code></pre>
</section>

<section  class=""><h2 id="rule-don-t-use-promises-as-callbacks">Rule: don&#39;t use promises as callbacks</h2>
<ul>
<li>unless you&#39;re applying side-effects</li>
</ul>
</section>

<section  class=""><h2 id="promises-collections">Promises + collections</h2>
<pre><code class="lang-javascript">var userIds = [10,20,30,50,100];

// array of promises
var users = userIds.map(User.get);

// promise for array of {user, account}
var usersWithAccounts = Promise.all(users)
  .then(function(users) {
    return users.map(function(user) {
      return Promise.all({
        user: user,
        account: Account.get(user)
      });
    });
  });
</code></pre>
</section>

<section  class=""><h2 id="promises-conclusion">Promises conclusion</h2>
<ul>
<li>promises = values for async</li>
<li>don&#39;t just use as callbacks</li>
<li>think about transformers for the values</li>
<li>chain promises flows together</li>
</ul>
</section>

<section  class=""><h2 id="let-s-try">Let&#39;s try</h2>
<ul>
<li>exercises/promises</li>
</ul>
</section>

<section data-state='title' class=" title"><h2 id="build-tools">Build tools</h2>
</section>

<section  class=""><h2 id="package-management">Package management</h2>
<ul>
<li><code>npm</code> - great for back/frontend</li>
<li><code>jspm</code> - good future proofing</li>
<li><code>bower</code> - probably had its day</li>
</ul>
</section>

<section  class=""><h2 id="modules">Modules</h2>
<ul>
<li><code>SystemJS</code> - ES6 style modules</li>
<li><code>browserify</code> - builds CommonJS style modules</li>
<li><code>webpack</code> - supports AMD/CommonJS (ES6 with plugins)</li>
</ul>
</section>

<section data-state='title' class=" title"><h2 id="quality">Quality</h2>
</section>

<section  class=""><h2 id="eslint">ESLint</h2>
<pre><code class="lang-sh">eslint exercises/some-exercise/exercise.js
</code></pre>
</section>

<section  class=""><h2 id="jscs">JSCS</h2>
<pre><code class="lang-sh">jscs exercises/some-exercise/exercise.js
</code></pre>
</section>

<section data-state='title' class=" title"><h2 id="developer-tools">Developer Tools</h2>
</section>

<section  class=""><h2 id="chrome">Chrome</h2>
<ul>
<li>CPU</li>
<li>memory</li>
<li>timeline</li>
</ul>
</section>

<section  class=""><h2 id="node-js">Node.js</h2>
<ul>
<li>node debugger - stepping etc</li>
<li>DTrace - more complex, same techniques</li>
</ul>
</section>

<section  class=""><h2 id="hands-on">Hands-on</h2>
<pre><code>exercise/profiling/index.html
</code></pre></section>

<section data-state='title' class=" title"><h2 id="wrap-">Wrap!</h2>
</section>

<section  class=""><h2 id="advanced-js">Advanced JS</h2>
<ul>
<li>Know the core, love functions</li>
<li>Data-structures &gt; code</li>
<li>Objects, the right way</li>
<li>Bring backup with async</li>
<li>Lean on tools!</li>
</ul>
</section>

<section  class=""><h2 id="thanks-">Thanks!</h2>
<p><a href="twitter.com/timruffles">@timruffles</a>
<a href="twitter.com/sidekicksrc">@sidekicksrc</a></p>
</section>

</div>
</div>

<!-- demo code -->
<script src="js/jquery.js"></script>
<script src="js/lodash.js"></script>
<script src="js/angular.js"></script>

<!-- live coding -->
<script src=js/little-console.js></script>
<script src=js/showConsoles.js></script>

<!-- reveal -->
<script src="reveal/lib/js/head.min.js"></script>
<script src="reveal/plugin/highlight/highlight.js"></script>
<script src="reveal/js/reveal.js"></script>
<script src="js/revealConfig.js"></script>

</body>
